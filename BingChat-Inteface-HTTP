from flask import Flask, request, render_template_string, send_file

app = Flask(__name__)

def funk(data):
    # Ваш код здесь
    return ["Ответ 1", "Ответ 2"]

def check_auth(username, password):
    # Замените на свою логику проверки имени пользователя и пароля
    return username == 'admin' and password == 'secret'

def save_to_file(data):
    with open('history.txt', 'a') as f:
        f.write(data + '\n')

def read_from_file():
    with open('history.txt', 'r') as f:
        return f.read()

def clear_file():
    open('history.txt', 'w').close()

@app.route('/', methods=['GET', 'POST'])
def index():
    if request.authorization and check_auth(request.authorization.username, request.authorization.password):
        result = ["", ""]
        show_history = False
        history = ""
        if request.method == 'POST':
            if 'data' in request.form:
                data = request.form['data']
                result = funk(data)
                save_to_file(result[0])
            elif 'show_history' in request.form:
                show_history = True
                history = read_from_file()
            elif 'hide_history' in request.form:
                show_history = False
            elif 'clear_history' in request.form:
                clear_file()
        return render_template_string('''
            <form method="post">
                Введите данные:<br>
                <textarea name="data" rows="4" cols="50"></textarea><br>
                <input type="submit" value="Отправить">
            </form>
            <h2>Ответ:</h2>
            <p>{{result[0]}}</p>
            <h2>Рекомендуемые дальнейшие запросы:</h2>
            <p>{{result[1]}}</p>
            {% if not show_history %}
                <form method="post">
                    <input type="hidden" name="show_history" value="1">
                    <input type="submit" value="Показать историю">
                </form>
            {% else %}
                <form method="post">
                    <input type="hidden" name="hide_history" value="1">
                    <input type="submit" value="Скрыть историю">
                </form>
                <h2>История:</h2>
                <pre>{{history}}</pre>
                <a href="/download">Скачать историю</a><br>
                <form method="post">
                    <input type="hidden" name="clear_history" value="1">
                    <input type="submit" value="Очистить историю">
                </form>
            {% endif %}
        ''', result=result, show_history=show_history, history=history)
    return 'Авторизация не пройдена', 401, {'WWW-Authenticate': 'Basic realm="Login Required"'}

@app.route('/download')
def download():
    return send_file('history.txt', as_attachment=True)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=80)
